## Сервис электронный кошелек

Необходимо разработать приложение EWallet реализующее систему обработки транзакций 
платёжной системы. Приложение должно быть реализовано в виде HTTP сервера, реализующее 
REST API. Сервер должен реализовывать 6 методов и их логику:

#### Создание кошелька
- Эндпоинт: POST /api/v1/wallet
- Параметры запроса отсутствуют
- Ответ содержит JSON-объект с состоянием созданного кошелька. Объект содержит параметры:
	- id – строковый ID кошелька. Генерируется сервером
	- balance – дробное число, баланс кошелька
- Созданный кошелек должен иметь сумму 100.0 у.е. на балансе

##### Пример
```bash
$ curl -i -X POST http://localhost:8080/api/v1/wallet

{
  	"id": "42eba5d2-da9b-4a40-bede-2ad7793aa974",
  	"balance": 100,
  	"status": "OK"
}
```

#### Перевод средств с одного кошелька на другой
- Эндпоинт - POST /api/v1/wallet/{walletId}/send
- Параметры запроса:
	- walletId – строковый ID кошелька, указан в пути запроса
	- JSON-объект в теле запроса с параметрами:
		- to – ID кошелька, куда нужно перевести деньги
		- amount – сумма перевода
- Статус ответа 200 если перевод успешен
- Статус ответа 404 если исходящий кошелек не найден
- Статус ответа 400 если целевой кошелек не найден или на исходящем нет нужной суммы

##### Пример
```bash
$ curl -i -X POST 'http://localhost:8080/api/v1/wallet/42eba5d2-da9b-4a40-bede-2ad7793aa974/send' \
-H "Content-Type: application/json" \
-d '{
	"to":"8239d908-2f15-40ac-a20d-b165d5012b22",
	"amount":12.15
}'

{
  	"status": "OK"
}
```

#### Пополнение баланса кошелька
- Эндпоинт - POST /api/v1/wallet/{walletId}/deposit
- Параметры запроса:
	- walletId – строковый ID кошелька, указан в пути запроса
	- JSON-объект в теле запроса с параметрами:
		- amount – сумма пополнения

##### Пример
```bash
$ curl -i -X POST 'http://localhost:8080/api/v1/wallet/42eba5d2-da9b-4a40-bede-2ad7793aa974/deposit' \
-H "Content-Type: application/json" \
-d '{
	"amount":120.22
}'

{
  	"status": "OK"
}
```

#### Cнятие средств с баланса кошелька
- Эндпоинт - POST /api/v1/wallet/{walletId}/withdraw
- Параметры запроса:
	- walletId – строковый ID кошелька, указан в пути запроса
	- JSON-объект в теле запроса с параметрами:
		- amount – сумма снятия

##### Пример
```bash
$ curl -i -X POST 'http://localhost:8080/api/v1/wallet/42eba5d2-da9b-4a40-bede-2ad7793aa974/withdraw' \
-H "Content-Type: application/json" \
-d '{
	"amount":22.00
}'

{
  	"status": "OK"
}
```

#### Получение историй входящих и исходящих транзакций
- Эндпоинт – GET /api/v1/wallet/{walletId}/history
- Параметры запроса:
	- walletId – строковый ID кошелька, указан в пути запроса
- Ответ с статусом 200 если кошелек найден. Ответ должен содержать в теле массив JSON-объектов с входящими и исходящими транзакциями кошелька. Каждый объект содержит параметры:
	- time – дата и время перевода в формате RFC 3339
	- from – ID исходящего кошелька
	- to – ID входящего кошелька
	- amount – сумма перевода. Дробное число
- Статус ответа 404 если указанный кошелек не найден

##### Пример
```bash
$ curl -i -X GET 'http://localhost:8080/api/v1/wallet/42eba5d2-da9b-4a40-bede-2ad7793aa974/history'

{
  "transactions": [
    {
      "time": "2024-10-27T15:09:35.700113Z",
      "from": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "to": "f0b6dfcd-0464-4976-9a9f-fc7382560841",
      "amount": 12.15
    },
    {
      "time": "2024-10-27T15:11:10.481953Z",
      "from": "00000000-0000-0000-0000-000000000000",
      "to": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "amount": 120.22
    },
    {
      "time": "2024-10-27T15:11:38.781783Z",
      "from": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "to": "00000000-0000-0000-0000-000000000000",
      "amount": 22
    },
    {
      "time": "2025-01-05T17:00:56.826392Z",
      "from": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "to": "f0b6dfcd-0464-4976-9a9f-fc7382560841",
      "amount": 12.15
    },
    {
      "time": "2025-01-05T17:05:14.614078Z",
      "from": "00000000-0000-0000-0000-000000000000",
      "to": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "amount": 120.22
    },
    {
      "time": "2025-01-05T17:08:54.764552Z",
      "from": "ce286e81-3470-411b-a6ac-6257724bbf20",
      "to": "00000000-0000-0000-0000-000000000000",
      "amount": 22
    }
  ],
  "status": "OK"
}
```
#### Получение текущего состояния кошелька
- Эндпоинт – GET /api/v1/wallet/{walletId}
- Параметры запроса:
	- walletId – строковый ID кошелька, указан в пути запроса
- Ответ с статусом 200 если кошелек найден. Ответ должен содержать в теле JSON-объект с текущим состоянием кошелька. Объект содержит параметры:
	- id – строковый ID кошелька. Генерируется сервером
	- balance – дробное число, баланс кошелька
- Статус ответа 404 если кошелек не найден

##### Пример
```bash
$ curl -i -X GET http://localhost:8080/api/v1/wallet/42eba5d2-da9b-4a40-bede-2ad7793aa974

{
  "id": "f0b6dfcd-0464-4976-9a9f-fc7382560841",
  "balance": 124.3,
  "status": "OK"
}
```

### Сборка и запуск приложения в Docker Compose

```shell script
$ make build
...............
$ make up
...............
```

### Полезные ссылки
- [Микросервис для работы с балансом пользователей](https://github.com/vprud/avito-test-work)
- [Банковская система](https://github.com/techschool/simplebank?tab=readme-ov-file)


Todo list:
 - реализовать тесты для 'deposit' и 'withdraw' обработчиков;
 - добавить OpenAPI документацию;
 - добавить параметры От, До для 'history' обработчика;
 - использовать SQL транзакции


gin - "net/http"
pgx - "pq"
goose - migrate
конфигурацию через ENV - yml
unit-тесты для сервисного слоя приложения - unit-тесты для handler'ов

в приложении использовать подход clean architecture
handler -> service -> repository

есть слой handler